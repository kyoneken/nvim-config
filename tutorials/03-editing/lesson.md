# 第3章: 編集操作 ✂️

効率的な編集テクニックをマスターしましょう。この章では、Neovimの真の力を発揮する編集コマンドを学びます。

**所要時間**: 30分〜1時間  
**前提**: 第1章、第2章の操作ができる

---

## 📚 学習内容

1. ヤンク（コピー）とペースト
2. ビジュアルモードの活用
3. テキストオブジェクト
4. 変更コマンド
5. レジスタの使い方
6. 繰り返しコマンド（.）

---

## 📋 ヤンク（コピー）とペースト

Neovimでは「コピー」を**ヤンク（yank）**と呼びます。

### 基本的なヤンク

```
yy または Y  - 現在行をヤンク
yw           - 単語をヤンク
y$           - カーソル位置から行末までヤンク
yG           - カーソル位置からファイル末尾までヤンク
```

### ペースト（貼り付け）

```
p  - カーソルの後ろに貼り付け
P  - カーソルの前に貼り付け
```

**動作の違い:**
- 行全体のヤンクの場合: 下の行/上の行に挿入
- 文字列のヤンクの場合: カーソルの右/左に挿入

### 削除は自動的にヤンク

```
dd  - 行を削除（ヤンクもされる）
dw  - 単語を削除（ヤンクもされる）
x   - 文字を削除（ヤンクもされる）
```

削除したものは `p` でペーストできます！

---

## 🎨 ビジュアルモードの活用

ビジュアルモードで範囲選択してから操作できます。

### ビジュアルモードの種類

```
v       - 文字単位のビジュアルモード
V       - 行単位のビジュアルモード
Ctrl-v  - 矩形（くけい）ビジュアルモード
```

### ビジュアルモードでできること

選択してから:
```
y  - ヤンク（コピー）
d  - 削除
c  - 変更（削除してInsertモード）
>  - インデント
<  - アンインデント
~  - 大文字小文字切り替え
```

**使い方例:**
1. `v` でビジュアルモード開始
2. `jjj` で3行下まで選択
3. `y` でヤンク
4. `p` でペースト

### 矩形選択（Ctrl-v）

垂直方向に選択できます。複数行を同時編集する時に便利！

**使い方例:**
1. `Ctrl-v` で矩形ビジュアルモード
2. `jjj` で下に選択
3. `I` で挿入モード（選択範囲の先頭）
4. `//` と入力
5. `ESC` で全行にコメント挿入

---

## 🎯 テキストオブジェクト

Vimの最強機能の一つ！「動詞 + テキストオブジェクト」で直感的に編集できます。

### テキストオブジェクトの種類

```
iw  - 単語の中（inner word）
aw  - 単語+空白（a word）
is  - 文の中（inner sentence）
as  - 文+空白（a sentence）
ip  - 段落の中（inner paragraph）
ap  - 段落+空白（a paragraph）
i"  - ""の中
a"  - ""を含む
i'  - ''の中
a'  - ''を含む
i(  - ()の中
a(  - ()を含む
i{  - {}の中
a{  - {}を含む
i[  - []の中
a[  - []を含む
it  - タグの中（HTML/XML）
at  - タグを含む
```

### 動詞との組み合わせ

```
d   - 削除（delete）
c   - 変更（change）
y   - ヤンク（yank）
v   - 選択（visual）
```

### 実用例

```
diw  - カーソル下の単語を削除
ciw  - カーソル下の単語を変更（削除してInsert）
yi"  - ""の中をヤンク
da(  - ()を含めて削除
ci{  - {}の中を変更
dit  - HTMLタグの中を削除
```

**例:** `"Hello, World!"` の中身を変更したい
1. カーソルを文字列上に置く
2. `ci"` と入力
3. 新しい文字列を入力
4. `ESC`

---

## 🔄 変更コマンド

`c` は「削除してInsertモード」に入る便利なコマンドです。

### 基本的な変更

```
cc または S  - 行全体を変更
cw           - 単語を変更
c$           - 行末まで変更
ciw          - カーソル下の単語を変更
ci"          - ""の中を変更
```

### その他の変更コマンド

```
r<文字>  - カーソル下の1文字を<文字>に置換
R        - 置換モード（複数文字を上書き）
s        - 1文字削除してInsert
S        - 行全体を削除してInsert
```

### 削除 vs 変更

```
dw  - 単語を削除（Normalモードのまま）
cw  - 単語を削除してInsertモードへ
```

使い分け: 削除だけなら `d`、削除して入力なら `c`

---

## 📦 レジスタの使い方

Neovimには複数のクリップボード（レジスタ）があります。

### 名前付きレジスタ

```
"ayy  - aレジスタに行をヤンク
"ap   - aレジスタからペースト
"byy  - bレジスタに行をヤンク
"bp   - bレジスタからペースト
```

**使い方:**
- 複数の箇所をコピーして使い分けたい時
- `"a`, `"b`, `"c` など a-z まで使える

### 特殊なレジスタ

```
""  - デフォルトレジスタ（通常のヤンク）
"0  - 最後にヤンクしたもの（削除は含まない）
"1  - 最後に削除したもの
"+  - システムクリップボード（他アプリと共有）
"*  - 選択範囲のクリップボード（X11）
```

### システムクリップボードとの連携

```
"+yy  - システムクリップボードに行をコピー
"+p   - システムクリップボードからペースト
```

**便利:** ブラウザからコピーした内容を `"+p` でNeovimに貼り付け！

### レジスタの確認

```vim
:reg      すべてのレジスタを表示
:reg a    aレジスタの内容を表示
```

---

## 🔁 繰り返しコマンド（.）

`.` は「直前の変更を繰り返す」魔法のコマンドです。

### 基本的な使い方

```
1. ciw  （単語を変更）
2. hello と入力
3. ESC
4. w    （次の単語へ移動）
5. .    （同じ変更を繰り返す）
```

### .が便利な場面

```
例1: 複数の単語を同じ単語に変更
ciw → 新しい単語 → ESC → w → . → w → .

例2: 複数行の先頭に同じ文字を追加
I → // → ESC → j → . → j → .

例3: 複数行を削除
dd → . → . → .
```

**コツ:** 繰り返したい操作は、一度に完結させる

---

## 🎯 実践練習

`practice.txt` を開いて練習しましょう:

```vim
:e ~/.config/nvim/tutorials/03-editing/practice.txt
```

### 練習問題1: ヤンクとペースト

1. `yy` で1行ヤンク
2. `j` で下の行へ
3. `p` でペースト
4. `P` で上にペースト

### 練習問題2: ビジュアルモード

1. `v` で選択開始
2. `jjj` で3行選択
3. `y` でヤンク
4. `G` でファイル末尾へ
5. `p` でペースト

### 練習問題3: テキストオブジェクト

practice.txt内の以下の行で:
```
local text = "Hello, World!"
```

1. カーソルをHelloに置く
2. `ciw` で単語を変更
3. `Goodbye` と入力
4. `ESC`

### 練習問題4: 矩形選択

複数行の先頭にコメントを追加:
1. `Ctrl-v` で矩形選択
2. `jjj` で3行選択
3. `I` で挿入モード
4. `-- ` と入力
5. `ESC`

### 練習問題5: 繰り返しコマンド

1. `ciw` で単語を "test" に変更
2. `w` で次の単語へ
3. `.` で繰り返す

---

## 💡 効率化のコツ

### 1. テキストオブジェクトを使いこなす

❌ `v` → `wwww` → `d` （選択範囲を調整しながら削除）  
✅ `daw` （単語を含めて一気に削除）

### 2. cコマンドで削除+入力を一度に

❌ `dw` → `i` → 入力  
✅ `cw` → 入力

### 3. .で繰り返す前提で操作を設計

同じ操作を複数箇所で行う時は、`.` で繰り返せるように設計する

### 4. システムクリップボードを活用

```
"+y  - Neovimから外部へ
"+p  - 外部からNeovimへ
```

---

## 🎓 チートシート

```
=== ヤンク・ペースト ===
yy / Y     行をヤンク
yw         単語をヤンク
p          後ろにペースト
P          前にペースト

=== ビジュアルモード ===
v          文字選択
V          行選択
Ctrl-v     矩形選択

=== テキストオブジェクト ===
diw        単語を削除
ciw        単語を変更
yi"        ""の中をヤンク
ci(        ()の中を変更

=== 変更 ===
cw         単語を変更
cc         行を変更
r<字>      1文字置換

=== レジスタ ===
"ayy       aレジスタにヤンク
"ap        aレジスタからペースト
"+yy       システムクリップボードへ
"+p        システムクリップボードから

=== 繰り返し ===
.          直前の変更を繰り返す
```

---

## ✅ 達成目標

- [ ] ヤンクとペーストが自由にできる
- [ ] ビジュアルモードで範囲選択できる
- [ ] テキストオブジェクト（diw, ci" など）が使える
- [ ] 矩形選択（Ctrl-v）で複数行を編集できる
- [ ] .で繰り返しコマンドを活用できる
- [ ] システムクリップボードと連携できる

すべてできたら、**[第4章: 検索とファイル操作](../04-search/)** に進みましょう！ 🚀

---

## 📝 練習のヒント

- テキストオブジェクトは最初難しいが、慣れると超便利
- `ciw` と `ci"` は特によく使う
- `.` コマンドは意識して使うと効率アップ
- 矩形選択は実際のコード編集で試してみよう
