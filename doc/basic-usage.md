# Neovim 基本操作ガイド

## 目次
1. [起動と終了](#起動と終了)
2. [モード切替](#モード切替)
3. [ファイル操作](#ファイル操作)
4. [検索機能](#検索機能)
5. [コード編集](#コード編集)
6. [Git操作](#git操作)
7. [LSP機能](#lsp機能)
8. [Copilot機能](#copilot機能)
9. [プラグイン管理](#プラグイン管理)
10. [トラブルシューティング](#トラブルシューティング)

---

## 起動と終了

### 起動
```bash
# 通常起動
nvim

# ファイルを指定して起動
nvim ファイル名

# 複数ファイルを開く
nvim file1.txt file2.txt
```

### 終了
| コマンド | 説明 |
|---------|------|
| `:q` | 終了 |
| `:q!` | 保存せずに終了 |
| `:w` | 保存 |
| `:wq` または `ZZ` | 保存して終了 |
| `<Space>q` | 終了（カスタムキー） |
| `<Space>w` | 保存（カスタムキー） |

---

## モード切替

Neovimには主に3つのモードがあります:

### Normalモード（通常モード）
- **デフォルトのモード** - コマンドを実行するモード
- 他のモードから戻る: `ESC` または `Ctrl-[`

### Insertモード（挿入モード）
- **テキストを入力するモード**
- 入り方:
  - `i` - カーソル位置から入力
  - `a` - カーソルの次の位置から入力
  - `o` - 下に新しい行を作って入力
  - `O` - 上に新しい行を作って入力
  - `A` - 行末から入力
  - `I` - 行頭から入力

### Visualモード（ビジュアルモード）
- **テキストを選択するモード**
- 入り方:
  - `v` - 文字単位で選択
  - `V` - 行単位で選択
  - `Ctrl-v` - 矩形選択（ブロック選択）

---

## ファイル操作

### ファイルツリー（Neo-tree）
| キー | 説明 |
|------|------|
| `<Space>e` | ファイルツリーの表示/非表示 |

#### Neo-tree内での操作
- `Enter` - ファイルを開く／ディレクトリを展開
- `<Tab>` - ファイルをプレビュー
- `a` - 新しいファイル/ディレクトリを作成
- `d` - 削除
- `r` - リネーム
- `y` - コピー
- `x` - カット
- `p` - ペースト
- `H` - 隠しファイルの表示/非表示
- `R` - リフレッシュ
- `q` または `<Space>e` - 閉じる

### バッファ操作
| キー | 説明 |
|------|------|
| `<Space>fb` | バッファ一覧を表示 |
| `Shift-h` | 前のバッファへ |
| `Shift-l` | 次のバッファへ |
| `<Space>x` | 現在のバッファを閉じる |

### ウィンドウ操作
| キー | 説明 |
|------|------|
| `Ctrl-h` | 左のウィンドウへ移動 |
| `Ctrl-j` | 下のウィンドウへ移動 |
| `Ctrl-k` | 上のウィンドウへ移動 |
| `Ctrl-l` | 右のウィンドウへ移動 |
| `Ctrl-Up/Down/Left/Right` | ウィンドウサイズ変更 |
| `:split` または `:sp` | 横分割 |
| `:vsplit` または `:vs` | 縦分割 |

---

## 検索機能

### Telescope（ファジーファインダー）
| キー | 説明 |
|------|------|
| `<Space>ff` | ファイル名で検索 |
| `<Space>fg` | ファイル内容を検索（grep） |
| `<Space>fb` | 開いているバッファから検索 |
| `<Space>fh` | ヘルプを検索 |
| `<Space>fr` | 最近使ったファイルから検索 |

#### Telescope内での操作
- `Ctrl-j` / `Ctrl-k` - 上下移動
- `Enter` - 選択して開く
- `Ctrl-x` - 横分割で開く
- `Ctrl-v` - 縦分割で開く
- `Ctrl-t` - タブで開く
- `Ctrl-q` - QuickFixリストに送る
- `ESC` - 閉じる

### ファイル内検索
| キー | 説明 |
|------|------|
| `/検索語` | 前方検索 |
| `?検索語` | 後方検索 |
| `n` | 次の検索結果へ（中央に表示） |
| `N` | 前の検索結果へ（中央に表示） |
| `ESC` | ハイライトを消す |
| `*` | カーソル下の単語を検索 |

---

## コード編集

### 基本的な編集操作
| キー | 説明 |
|------|------|
| `yy` | 行をコピー（ヤンク） |
| `dd` | 行を削除（カット） |
| `p` | カーソルの下/後にペースト |
| `P` | カーソルの上/前にペースト |
| `u` | アンドゥ（取り消し） |
| `Ctrl-r` | リドゥ（やり直し） |
| `.` | 直前の操作を繰り返す |

### インデント操作
| キー | 説明 |
|------|------|
| `>>` | 行を右にインデント |
| `<<` | 行を左にインデント |
| `>` (Visualモード) | 選択範囲を右にインデント |
| `<` (Visualモード) | 選択範囲を左にインデント |

**ビジュアルモードでは連続実行可能:**
- 範囲選択後 `>` または `<` を押すと、選択状態を保持したまま連続でインデント調整できます

### コメント操作
| キー | 説明 |
|------|------|
| `gcc` | 行をコメント/コメント解除 |
| `gc` (Visualモード) | 選択範囲をコメント/コメント解除 |

### Treesitter機能
| キー | 説明 |
|------|------|
| `Ctrl-Space` | 範囲選択を開始/拡大 |
| `Backspace` | 範囲選択を縮小 |

---

## Git操作

### Gitsigns（差分表示）
| キー | 説明 |
|------|------|
| `]c` | 次の変更箇所へ |
| `[c` | 前の変更箇所へ |
| `<Space>hp` | 変更箇所をプレビュー |
| `<Space>hs` | Hunk（変更箇所）をステージ |
| `<Space>hr` | Hunk（変更箇所）をリセット |
| `<Space>hb` | 行のBlame表示（誰が変更したか） |
| `<Space>hd` | Diff表示 |

### LazyGit
| キー | 説明 |
|------|------|
| `<Space>gg` | LazyGitを起動 |

**LazyGit内の基本操作:**
- `?` - ヘルプ表示
- `Space` - ステージ/アンステージ
- `c` - コミット
- `P` - プッシュ
- `p` - プル
- `q` - 終了

### Fugitive
| キー | 説明 |
|------|------|
| `<Space>gG` | Git status表示 |
| `:Git` または `:G` | Gitコマンド実行 |

### Telescope Git機能
| キー | 説明 |
|------|------|
| `<Space>gs` | Git status |
| `<Space>gc` | Gitコミット履歴 |
| `<Space>gb` | Gitブランチ一覧 |

---

## LSP機能

LSP（Language Server Protocol）は、コード補完・定義ジャンプ・エラー表示などを提供します。

### コードナビゲーション
| キー | 説明 |
|------|------|
| `gd` | 定義へジャンプ |
| `gD` | 宣言へジャンプ |
| `gi` | 実装へジャンプ |
| `gr` | 参照を表示 |
| `K` | ホバー情報を表示 |
| `Ctrl-k` | シグネチャヘルプ |

### 診断（エラー・警告）
| キー | 説明 |
|------|------|
| `]d` | 次の診断へ |
| `[d` | 前の診断へ |
| `<Space>dd` | 診断一覧を表示（Trouble） |

### LSPアクション
| キー | 説明 |
|------|------|
| `<Space>lr` | リネーム |
| `<Space>la` | コードアクション |
| `<Space>lf` | フォーマット |
| `<Space>li` | LSP情報 |

### 補完機能（nvim-cmp）
| キー | 説明 |
|------|------|
| `Tab` | 次の候補へ / スニペット展開 |
| `Shift-Tab` | 前の候補へ |
| `Enter` | 選択を確定 |
| `Ctrl-Space` | 補完を手動で起動 |
| `Ctrl-e` | 補完をキャンセル |
| `Ctrl-b` / `Ctrl-f` | ドキュメントスクロール |

---

## Copilot機能

### コード補完
| キー | 説明 |
|------|------|
| `Ctrl-j` | Copilotの提案を受け入れ |
| `Alt-]` | 次の提案へ |
| `Alt-[` | 前の提案へ |
| `Ctrl-e` | 提案を却下 |

### CopilotChat（ビジュアルモードで選択後）
| キー | 説明 |
|------|------|
| `<Space>ce` | コードを説明してもらう |
| `<Space>cr` | コードレビューを依頼 |
| `<Space>cf` | バグを修正してもらう |
| `<Space>co` | コードを最適化してもらう |
| `<Space>cd` | ドキュメントを追加してもらう |
| `<Space>ct` | テストケースを作成してもらう |

### CopilotChat（ノーマルモード）
| キー | 説明 |
|------|------|
| `<Space>cc` | チャットウィンドウを開く/閉じる |
| `<Space>cC` | コミットメッセージを生成 |
| `<Space>cS` | ステージ済み変更のコミットメッセージ生成 |

**使い方の例:**
1. コードをビジュアルモードで選択（`v`や`V`）
2. `<Space>ce`で説明を依頼
3. チャット画面が開き、日本語で説明が表示されます

---

## プラグイン管理

### Lazy.nvim
| キー | 説明 |
|------|------|
| `<Space>L` | Lazy UIを開く |

#### Lazy UI内での操作
- `I` - プラグインをインストール
- `U` - すべて更新
- `S` - プラグインを同期
- `X` - 不要なプラグインを削除
- `C` - 変更履歴を表示
- `L` - ログを表示
- `P` - プロファイルを表示
- `?` - ヘルプ
- `q` - 閉じる

### LSPサーバー管理
```vim
:Mason
```

**Mason UI内での操作:**
- `/` - 検索
- `i` - インストール
- `u` - アンインストール
- `U` - すべて更新
- `g?` - ヘルプ
- `q` - 閉じる

---

## トラブルシューティング

### 健全性チェック
```vim
:checkhealth
```
システムの状態や不足している依存関係を確認できます。

### プラグインの再インストール
```vim
:Lazy sync
```

### LSPサーバーの再起動
```vim
:LspRestart
```

### ログの確認
```vim
:Lazy log
:LspLog
```

### キーマップの確認
```vim
:Telescope keymaps
```

### 設定の再読み込み
```vim
:source ~/.config/nvim/init.lua
```

または、Neovimを再起動してください。

---

## よく使うコマンド一覧

### クイックリファレンス
```
# 移動
h, j, k, l    - 左、下、上、右
w, b          - 単語単位で前後移動
0, $          - 行頭、行末
gg, G         - ファイルの先頭、末尾

# 編集
i, a          - 挿入モード
o, O          - 新しい行を追加
d, y, p       - 削除、コピー、ペースト
u, Ctrl-r     - アンドゥ、リドゥ

# 検索・置換
/pattern      - 検索
:%s/old/new/g - 置換

# ファイル
<Space>ff     - ファイル検索
<Space>fg     - テキスト検索
<Space>e      - ファイルツリー

# Git
<Space>gg     - LazyGit
<Space>hp     - 変更プレビュー

# LSP
gd            - 定義へ
K             - ドキュメント表示
<Space>lr     - リネーム

# Copilot
Ctrl-j        - 提案を受け入れ
<Space>ce     - コード説明（選択後）
```

---

## さらに学ぶには

1. **Vimの基礎**: `:Tutor` でVimの基本チュートリアルを実行
2. **ヘルプ**: `:help <keyword>` でヘルプを表示
3. **キーマップ一覧**: `<Space>` を押して少し待つと、Which-keyが候補を表示
4. **プラグインのドキュメント**: 各プラグインの設定ファイルを参照

---

**次のステップ**: `advanced-usage.md`で高度な機能を学びましょう!
